# 公司信息采集与调研报告系统 - 需求分析文档

> 版本: 1.0
> 日期: 2026-02-03
> 状态: 已确认

---

## 1. 项目概述

### 1.1 项目名称
Company Tracker - 公司信息采集与调研报告系统

### 1.2 项目目标
为用户提供一个便捷的公司信息采集和调研报告生成平台，通过自动化采集多渠道信息源，结合AI能力生成专业调研报告。

### 1.3 目标用户
富有人文色彩的科技型创业公司员工，需要对特定公司进行信息收集和分析的用户。

---

## 2. 功能需求

### 2.1 用户系统

#### 2.1.1 用户注册
- 支持邮箱注册
- 密码要求：最少8位，包含字母和数字
- 密码存储：使用 bcrypt 加密，不存储明文
- 密码传输：HTTPS 加密传输

#### 2.1.2 用户登录
- 邮箱 + 密码登录
- 支持"记住我"功能
- 登录失败次数限制（5次后锁定15分钟）
- JWT Token 认证机制

#### 2.1.3 用户管理
- 支持多用户同时在线
- 每个用户有唯一ID
- 用户可修改密码

### 2.2 调研任务管理

#### 2.2.1 任务列表页（登录后首页）
- 展示用户所有调研任务
- 显示每个任务的：公司名、关注点、当前步骤、状态、更新时间
- 支持新建、继续、删除任务
- **限制：每个用户最多同时进行3个任务**

#### 2.2.2 任务状态
| 步骤 | 名称 | 状态说明 |
|------|------|----------|
| 1 | 添加公司 | 填写公司名和关注点 |
| 2 | 确认信息源 | 查看、优化、勾选信息源 |
| 3 | 采集信息 | 系统采集文章，用户查看筛选 |
| 4 | 生成报告 | 配置模板，生成调研报告 |

#### 2.2.3 状态持久化
- 用户在任意步骤离开，状态自动保存
- 用户回来后可从上次位置继续
- 采集任务在后台继续执行

### 2.3 信息源获取（步骤2）

#### 2.3.1 信息源来源（三种方式）
1. **内置信息源过滤**
   - 从968个预置信息源中筛选
   - 根据公司名和关注点匹配分类

2. **网络搜索**
   - 使用 SearXNG 搜索引擎
   - 搜索 "公司名 + 关注点 + RSS/Blog/新闻"
   - 提取搜索结果中的信息源

3. **Deepseek推荐**
   - 调用 Deepseek V3 API
   - 输入公司名和关注点
   - 返回推荐的信息源列表

#### 2.3.2 信息源类型
- 公司官网
- RSS/Atom Feed
- 博客
- 新闻网站
- 信息聚合平台

#### 2.3.3 信息源交互优化
- 展示所有获取到的信息源
- 提供输入框与 Deepseek 交互优化
- **输入内容校验**：只允许与本应用相关的输入，否则拒绝并提示
- 用户可勾选确定最终使用的信息源

### 2.4 信息采集（步骤3）

#### 2.4.1 采集方式
1. **信息源爬取**
   - 爬取用户选定的信息源
   - 获取最近2个月的文章
   - 过滤出与公司名和关注点相关的内容

2. **搜索引擎采集**
   - 搜索 "公司名 + 关注点"
   - 获取前20项结果
   - 提取文章内容

#### 2.4.2 爬取程序
- 参考 news-agent 项目的爬虫实现
- 支持：RSS/Atom、博客、新闻网站、JS渲染页面
- 智能内容提取和清理

#### 2.4.3 内容展示
- **分页签展示**：信息源 | 搜索引擎
- **列表形式**：时间维度 + 卡片列表
- **卡片内容**：标题、摘要、来源、时间
- **详情页面**：点击卡片查看完整文章，有返回按钮

### 2.5 报告生成（步骤4）

#### 2.5.1 文章选择
- 用户在卡片上勾选文章
- 支持全选/全不选快捷操作

#### 2.5.2 报告模板
- 系统内置默认总结模板
- 模板包含用户关注的方面
- 用户可修改模板内容
- 用户可通过描述让系统自动调整模板章节

#### 2.5.3 报告生成
- 调用 Deepseek API
- 输入：选中文章内容 + 关注点 + 模板
- 输出：Markdown 格式报告

#### 2.5.4 报告输出
- 支持在线查看（Markdown渲染）
- 支持下载到本地（.md文件）

---

## 3. 非功能需求

### 3.1 界面设计

#### 3.1.1 设计风格
- 极简、现代、有未来感
- 高级感与温暖感结合
- 适合科技创业公司员工使用

#### 3.1.2 响应式设计
- 支持桌面浏览器（Chrome、Firefox、Safari、Edge）
- 支持移动端浏览器（iOS Safari、Android Chrome）
- 自动适配屏幕尺寸
- 文字和表格不溢出屏幕

#### 3.1.3 语言
- 仅中文界面

### 3.2 用户体验

#### 3.2.1 进度提示
- 所有耗时操作显示进度栏
- 进度栏位于页面底部，全局可见
- 支持收起/展开查看详情
- 默认收起，显示简略信息

#### 3.2.2 步骤引导
- 页面顶部显示步骤条
- 展示当前进度和整体流程
- 每步提供简洁的操作提示

### 3.3 数据持久化
- 所有状态信息存入数据库
- 文章内容存入数据库
- 用户离开后数据不丢失
- 支持随时恢复到之前的状态

### 3.4 管理功能
- 独立的管理员界面
- 管理员通过配置文件指定
- 支持查看所有数据库表
- 支持清空、删除表数据

---

## 4. 技术约束

### 4.1 技术栈
| 层面 | 技术选型 |
|------|----------|
| 前端框架 | Next.js |
| 后端框架 | Node.js + Express |
| 数据库 | PostgreSQL |
| 搜索引擎 | SearXNG（可切换Bing） |
| AI模型 | Deepseek V3 |
| 部署平台 | Railway |

### 4.2 外部依赖
- Deepseek API Key（已有）
- SearXNG 公共实例或自建实例
- 参考 news-agent 爬虫代码

### 4.3 部署要求
- 支持本地开发环境
- 支持 Railway 云端部署
- 先本地验证，再部署线上

---

## 5. 用户流程图

```
┌─────────────┐
│   注册/登录  │
└──────┬──────┘
       ▼
┌─────────────┐
│  任务列表页  │ ←─────────────────────────┐
└──────┬──────┘                            │
       ▼                                   │
┌─────────────┐                            │
│ 步骤1:      │                            │
│ 添加公司    │ 填写公司名+关注点           │
└──────┬──────┘                            │
       ▼                                   │
┌─────────────┐                            │
│ 步骤2:      │                            │
│ 确认信息源  │ 查看→优化→勾选              │
└──────┬──────┘                            │
       ▼                                   │
┌─────────────┐                            │
│ 步骤3:      │                            │
│ 采集信息    │ 查看文章列表→查看详情       │
└──────┬──────┘                            │
       ▼                                   │
┌─────────────┐                            │
│ 步骤4:      │                            │
│ 生成报告    │ 勾选文章→配置模板→生成      │
└──────┬──────┘                            │
       ▼                                   │
┌─────────────┐                            │
│  查看/下载   │ ──────────────────────────┘
│    报告     │
└─────────────┘
```

---

## 6. 数据实体

### 6.1 用户 (User)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| email | String | 邮箱，唯一 |
| password_hash | String | 密码哈希 |
| created_at | Timestamp | 创建时间 |
| updated_at | Timestamp | 更新时间 |

### 6.2 调研任务 (ResearchTask)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| user_id | UUID | 用户ID |
| company_name | String | 公司名 |
| focus_points | Text | 关注点 |
| current_step | Integer | 当前步骤(1-4) |
| status | String | pending/in_progress/completed |
| created_at | Timestamp | 创建时间 |
| updated_at | Timestamp | 更新时间 |

### 6.3 信息源 (DataSource)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| task_id | UUID | 任务ID |
| name | String | 信息源名称 |
| url | String | 信息源URL |
| type | String | rss/blog/news/website |
| source_origin | String | builtin/search/deepseek |
| selected | Boolean | 是否选中 |

### 6.4 采集文章 (Article)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| task_id | UUID | 任务ID |
| source_id | UUID | 信息源ID（可空） |
| title | String | 标题 |
| content | Text | 内容 |
| summary | String | 摘要 |
| url | String | 原文URL |
| publish_date | Timestamp | 发布时间 |
| source_type | String | datasource/search |
| selected | Boolean | 是否选中用于报告 |

### 6.5 调研报告 (Report)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| task_id | UUID | 任务ID |
| template | Text | 使用的模板 |
| content | Text | 报告内容(Markdown) |
| created_at | Timestamp | 创建时间 |

### 6.6 内置信息源 (CuratedSource)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| name | String | 信息源名称 |
| url | String | 信息源URL |
| type | String | rss/atom/feed/blog/news |
| category | String | 分类 |
| description | String | 描述 |
| region | String | 地区 |

---

## 7. 验收标准

### 7.1 功能验收
- [ ] 用户可以注册、登录、登出
- [ ] 用户可以创建、查看、删除调研任务
- [ ] 用户最多同时有3个进行中的任务
- [ ] 步骤1：可以输入公司名和关注点
- [ ] 步骤2：可以获取并优化信息源，与Deepseek交互
- [ ] 步骤3：可以查看采集的文章列表和详情
- [ ] 步骤4：可以勾选文章、配置模板、生成报告
- [ ] 报告可以在线查看和下载
- [ ] 管理员可以管理数据库表

### 7.2 体验验收
- [ ] 桌面浏览器正常显示
- [ ] 手机浏览器正常显示，无溢出
- [ ] 耗时操作有进度提示
- [ ] 步骤条清晰展示流程
- [ ] 离开后回来可继续任务

### 7.3 技术验收
- [ ] 密码加密存储
- [ ] 所有测试用例通过
- [ ] 本地部署正常运行
- [ ] Railway部署正常运行
